<!doctype html>
<html>
  <head>
    <title><%= title %></title>
    <link href="/assets/css/index.css" rel="stylesheet" />

    <!--Google fonts-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    
    <!-- Google icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
  </head>
  <body>
    <div>
      <nav>

      </nav>
      <header>
        <h1><%= title %></h1>
        <a class="add-track" href="/tracks/create">New Track</a>
      </header>
      <main>
        <div class="searchbar">
          <div class="search-input">
            <label for="search-track">
              <span class="material-symbols-outlined">search</span>
            </label>
            <input
              type="search"
              name="search-track"
              id="search-track"
              value="<%= selectedFilter.str %>"
              placeholder="Search Track"
              aria-label="Search through all tracks"
            />
        </div>
        </div>

        <div class="filter">
          <div>
            <label for="mood-select">Mood </label>
            <select name="moodId" id="mood-select">
              <option value="">any</option>
              <% moods.map((mood) => { %>
              <option value="<%= mood.id %>" 
                <%= selectedFilter.moodId  == mood.id ? "selected" : "" %>
              >
                <%= mood.mood %>
              </option>
              <% }); %>
            </select>
          </div>
          <div>
            <label for="key-select">Key</label>
            <select name="keyId" id="key-select">
              <option value="">any</option>

              <% keys.map((key) => { %>
              <option value="<%= key.id %>" 
                <%= selectedFilter.keyId  == key.id ? "selected" : "" %>
              >
                <%= key.key %>/<%= key.key_camelot%>
              </option>
              <% }); %>
            </select>
          </div>
        </div>

        <% if (tracks.length === 0) { %>
          <p>No tracks found</p>
        <% } else { %>
          <%- include("partials/trackList.ejs", {tracks}) %>
        <% } %>
      </main>
    </div>
    <script>
      const toggleDropdown = (e) => {
        const dropdownElement = e.parentNode.children[1];

        if (dropdownElement.classList.contains("dropdown-visible")) {
          dropdownElement.classList.remove("dropdown-visible");
        } else {
          const dropdowns = Array.from(document.querySelectorAll(".dropdown-menu"));
          dropdowns.forEach((dropdown) => dropdown.classList.remove("dropdown-visible"));      
          
          // const dropdownElement = e.parentNode.children[1];
          dropdownElement.classList.add("dropdown-visible");
        }
        console.log(dropdownElement);
      };

      // const closeDropdown = () => {
      //   const dropdowns = Array.from(document.querySelectorAll(".dropdown-menu"));
      //   if (dropdowns.length === 0) {
      //     dropdowns.forEach((dropdown) => dropdown.classList.remove("dropdown-visible"));
      //   }
      // }

      const searchElement = document.querySelector("#search-track");
      searchElement.onchange = (e) =>
        (location.href = `/tracks/?str=${searchElement.value}&keyId=${keyDropdown.value}&moodId=${moodDropdown.value}`);

      const moodDropdown = document.querySelector("#mood-select");
      moodDropdown.onchange = (e) =>
        (location.href = `/tracks/?str=${searchElement.value}&keyId=${keyDropdown.value}&moodId=${e.target.value}`);

      const keyDropdown = document.querySelector("#key-select");
      keyDropdown.onchange = (e) =>
        (location.href = `/tracks/?str=${searchElement.value}&keyId=${e.target.value}&moodId=${moodDropdown.value}`);

      // window.addEventListener('click', closeDropdown);
    </script>
  </body>
</html>
